name: Notify DISCORD on PR Opened
on:
  pull_request:
    types: [opened, reopened]

jobs:
  Notify-PR-Open:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord message
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"
          PR_URL="${{ github.event.pull_request.html_url }}"
          AUTHOR="${{ github.actor }}"
          SOURCE_BRANCH="${{ github.event.pull_request.head.ref }}"
          TARGET_BRANCH="${{ github.event.pull_request.base.ref }}"

          cat <<EOF > discord-payload.json
          {
            "embeds": [
              {
                "title": "ğŸ“Œ ìƒˆ PRì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!",
                "description": "**ì œëª©:** ${PR_TITLE}",
                "url": "${PR_URL}",
                "fields": [
                  {
                    "name": "ì‘ì„±ì",
                    "value": "${AUTHOR}",
                    "inline": true
                  },
                  {
                    "name": "ë¸Œëœì¹˜",
                    "value": "${SOURCE_BRANCH} â†’ ${TARGET_BRANCH}",
                    "inline": true
                  }
                ]
              }
            ]
          }
          EOF

          curl -i -H 'Accept: application/json' \
            -H 'Content-Type: application/json' \
            -X POST -d @discord-payload.json \
            ${{ secrets.DISCORD_WEBHOOK }}
